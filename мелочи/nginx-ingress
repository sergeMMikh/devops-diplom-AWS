helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update
helm install ingress-nginx ingress-nginx/ingress-nginx --namespace kube-system

kubectl get pods -n kube-system | grep ingress-nginx
kubectl get svc -n kube-system | grep ingress-nginx


kubectl get pods -n ingress-nginx
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/cloud/deploy.yaml
kubectl get ingress -n monitoring

для виртуалки:
kubectl get svc -n ingress-nginx
echo "192.168.33.101 grafana.demo.com alertmanager.demo.com prometheus.demo.com" | sudo tee -a /etc/hosts

kubectl get deployment -n ingress-nginx ingress-nginx-controller -o yaml > ingress-nginx.yaml
nano ingress-nginx.yaml


kubectl get pods -n ingress-nginx


helm repo add eks https://aws.github.io/eks-charts
helm repo update
helm install aws-load-balancer-controller eks/aws-load-balancer-controller \
    --namespace kube-system \
    --set clusterName=diplom-claster \
    --set serviceAccount.create=false \
    --set serviceAccount.name=aws-load-balancer-controller

helm install aws-load-balancer-controller eks/aws-load-balancer-controller \
    -n kube-system \
    --set clusterName=diplom-claster \
    --set serviceAccount.create=false \
    --set serviceAccount.name=aws-load-balancer-controller

curl -O https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.11.0/docs/install/iam_policy.json
aws iam create-policy --policy-name AWSLoadBalancerControllerIAMPolicy --policy-document file://iam_policy.json

eksctl utils associate-iam-oidc-provider --cluster=diplom-claster --approve


$ eksctl create iamserviceaccount \
    --cluster=diplom-claster \
    --namespace=kube-system \
    --name=aws-load-balancer-controller \
    --role-name AmazonEKSLoadBalancerControllerRole \
    --attach-policy-arn=arn:aws:iam::1335-0075-9208:policy/AWSLoadBalancerControllerIAMPolicy \
    --approve


vpc-0eeef6f879c21ad6d

helm install aws-load-balancer-controller eks/aws-load-balancer-controller \
    -n kube-system \
    --set clusterName=diplom-claster \
    --set serviceAccount.create=false \
    --set serviceAccount.name=aws-load-balancer-controller \
    --set region=eu-central-1 \
    --set vpcId=vpc-0eeef6f879c21ad6d


$ aws elbv2 describe-target-groups --names eks-ingress-tg --query "TargetGroups[*].TargetType"
[
"instance"
]

resource "aws_lb_target_group" "ingress_tg" {
name        = "eks-ingress-tg"
port        = 80
protocol    = "HTTP"
vpc_id      = var.vpc_id
target_type = "ip"  # <--- поменять с "instance" на "ip"
}
